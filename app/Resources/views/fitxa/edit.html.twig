{% extends 'base.html.twig' %}
{% block menua %}
    {{ parent() }}
    <nav class="navbar navbar-default navbar-lower" data-spy="affix" data-offset-top="5">
        <div class="container">
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                           aria-expanded="false">{{ 'messages.fitxak'|trans }}
                            <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            {% if (eremuak["helburuatext"]==1) %}
                                <li><a href="#helburua">Helburua</a></li>
                            {% endif %}
                            {% if ((eremuak["norkeskatutext"]==1) or (eremuak["norkeskatutable"]==1)) %}
                                <li><a href="#norkeskatu">Nork eska dezake?</a></li>
                            {% endif %}
                            {% if ((eremuak["dokumentazioatext"]==1) or (eremuak["dokumentazioatable"]==1)) %}
                                <li><a href="#dokumentazioa">Dokumentazioa</a></li>
                            {% endif %}

                            {% if ((eremuak["doklaguntext"]==1) or (eremuak["doklaguntable"]==1)) %}
                                <li><a href="#dokumentuLaguntzaileak">Dokumentazio Laguntzailea</a></li>
                            {% endif %}

                            {% if ((eremuak["kanalatext"]==1) or (eremuak["kanalatable"]==1)) %}
                                <li><a href="#kanala">Kanala</a></li>
                            {% endif %}

                            {% if ((eremuak["kostuatext"]==1) or (eremuak["kostuatable"]==1)) %}
                                <li><a href="#kostua">Kostua</a></li>
                            {% endif %}

                            {% if ((eremuak["ebazpensinpli"]==1) or (eremuak["arduraaitorpena"]==1) or (eremuak["aurreikusi"]==1) or (eremuak["arrunta"]==1) or (eremuak["isiltasunadmin"]==1)) %}
                                <li><a href="#epeak">Epeak</a></li>
                            {% endif %}

                            {% if ((eremuak["araudiatext"]==1) or (eremuak["araudiatable"]==1)) %}
                                <li><a href="#araudia">Araudia</a></li>
                            {% endif %}

                            {% if ((eremuak["prozeduratext"]==1) or (eremuak["prozeduratable"]==1)) %}
                                <li><a href="#prozedurak">Prozedurak</a></li>
                            {% endif %}

                            {% if ((eremuak["norkebatzitext"]==1) or (eremuak["norkebatzitable"]==1)) %}
                                <li><a href="#norkebatzi">nork onartu behar du?</a></li>
                            {% endif %}

                            <li><a href="#azpisaila">Azpisaila</a></li>

                            {% if ((eremuak["oharraktext"]==1)) %}
                                <li><a href="#oharrak">Oharrak</a></li>
                            {% endif %}

                            {% if ((eremuak["besteak1text"]==1) or (eremuak["besteak1table"]==1)) %}
                                <li><a href="#besteak1">Besteak1</a></li>
                            {% endif %}

                            {% if ((eremuak["besteak2text"]==1) or (eremuak["besteak2table"]==1)) %}
                                <li><a href="#besteak2">Besteak2</a></li>
                            {% endif %}

                            {% if ((eremuak["besteak3text"]==1) or (eremuak["besteak3table"]==1)) %}
                                <li><a href="#besteak3">Besteak3</a></li>
                            {% endif %}

                            {% if is_granted('ROLE_ADMIN') %}
                                <li role="separator" class="divider"></li>
                                <li><a href="#familia">Familiak</a></li>
                                <li><a href="#etiketak">Etiketak</a></li>
                                <li><a href="#espedienteKudeaketa">Espediente Kudeaketa</a></li>
                                <li><a href="#admin">Admin</a></li>

                            {% endif %}
                        </ul>
                    </li>
                    <li><a href="#">{% if app.request.getLocale()=="eu" %}
                                {{ fitxa.espedientekodea }} - {{ fitxa.deskribapenaeu|length > 100 ? fitxa.deskribapenaeu|slice(0, 100) ~ '...' : fitxa.deskribapenaeu }}
                            {% else %}
                                {{ fitxa.espedientekodea }} - {{ fitxa.deskribapenaes|length > 100 ? fitxa.deskribapenaes|slice(0, 100) ~ '...' : fitxa.deskribapenaes }}
                            {% endif %}</a></li>
                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <li>
                        {#<a href="javascript:void(0);" onclick="document.forms['{{ edit_form.vars.name }}'].submit()" class="fa fa-floppy-o"> {{ 'messages.gorde'|trans }}</a>#}
                        <a href="javascript:void(0);" id="btnFitxaGrabatu" class="fa fa-floppy-o"> {{ 'messages.gorde'|trans }}</a>
                    </li>
                    <li>
                        <a href="{{ path('fitxa_show', { 'id': fitxa.id }) }}"
                           class="fa fa-search"> {{ 'messages.fitxaikusi'|trans }}</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <style>
        .loading {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, .8) url({{ asset('bundles/backend/img/page-loader.gif') }}) 50% 50% no-repeat !important;
        }

        body.loading {
            overflow: hidden;
        }

        body.loading .modal {
            display: block;
        }

        .select2-container--bootstrap .select2-dropdown {
            margin-top: 18px !important;
        }
    </style>
{% endblock %}
{% block body %}
    <div id="nireloader" class=""></div>
    {{ form_start(edit_form, {'attr': {'id':'frm_fitxa_edit'}}) }}
    <div class="row">
        <div class="col-md-2 text-center">
            <img src='{{ fitxa.udala.logoa }}'/>
            <h4>{{ fitxa.udala.izendapenaeu }}</h4>
            <h5>{{ fitxa.udala.ifk }}</h5>
        </div>

        <div class="col-md-2"><br/><br/>
            <h1>
                {{ form_label(edit_form.espedientekodea, 'KODEA: ', { 'label_attr': {'class': 'control-label'} }) }}
                {{ form_errors(edit_form.espedientekodea) }}
                {{ form_widget(edit_form.espedientekodea, {'attr': {'class': 'form-control ckeditor'}}) }}
            </h1>
        </div>

        <div class="col-md-8">
            <h1>
                {{ form_label(edit_form.deskribapenaeu, 'Deskribapena: ', { 'label_attr': {'class': 'control-label'} }) }}
                {{ form_errors(edit_form.deskribapenaeu) }}
                {{ form_widget(edit_form.deskribapenaeu, {'attr': {'class': 'form-control'}}) }}
            </h1>
            <h3>
                {{ form_label(edit_form.deskribapenaes, 'Descripción: ', { 'label_attr': {'class': 'control-label'} }) }}
                {{ form_errors(edit_form.deskribapenaes) }}
                {{ form_widget(edit_form.deskribapenaes, {'attr': {'class': 'form-control'}}) }}
            </h3>
        </div>
    </div>

    {% if eremuak.helburuatext %}
        <div class="row" id="helburua">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.helburualabeleu }}</h2>
                </div>
                <div class="form-group">
                    {{ form_errors(edit_form.helburuaeu) }}
                    {{ form_widget(edit_form.helburuaeu, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.helburualabeles }}</h2>
                </div>
                <div class="form-group">
                    {{ form_errors(edit_form.helburuaes) }}
                    {{ form_widget(edit_form.helburuaes, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
        </div>
    {% endif %}

    {% if (eremuak.norkeskatutext or eremuak.norkeskatutable) %}
        <div class="row" id="norkeskatu">
        <div class="col-sm-6">
            <div class="page-header">
                <h2>{{ labelak.norkeskatulabeleu }}</h2>
            </div>
            {% if eremuak.norkeskatutext %}
                <div class="form-group">
                    {{ form_errors(edit_form.norkeu) }}
                    {{ form_widget(edit_form.norkeu, {'attr': {'class': 'form-control'}}) }}
                </div>
            {% endif %}
        </div>
        <div class="col-sm-6">
            <div class="page-header">
                <h2>{{ labelak.norkeskatulabeleu }}</h2>
            </div>
            {% if eremuak.norkeskatutext %}
                <div class="form-group">
                    {{ form_errors(edit_form.norkes) }}
                    {{ form_widget(edit_form.norkes, {'attr': {'class': 'form-control'}}) }}
                </div>
            {% endif %}
        </div>
        {% if eremuak.norkeskatutable %}
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
        {% else %}
            <div class="hidden col-sm-12">
        {% endif %}
        <div>
            <br/>
            {{ form_errors(edit_form.norkeskatuak) }}
            {{ form_widget(edit_form.norkeskatuak, {'attr': {'class': 'form-group'}}) }}
        </div>
        </div>
        </div>
    {% endif %}

    {% if (eremuak.dokumentazioatext or eremuak.dokumentazioatable) %}
        <div class="row" id="dokumentazioa">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.dokumentazioalabeleu }}</h2>
                </div>
                {% if eremuak.dokumentazioatext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.dokumentazioaeu) }}
                        {{ form_widget(edit_form.dokumentazioaeu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.dokumentazioalabeles }}</h2>
                </div>
                {% if eremuak.dokumentazioatext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.dokumentazioaes) }}
                        {{ form_widget(edit_form.dokumentazioaes, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            {% if eremuak.dokumentazioatable %}
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                    <div class="form-group">
                        {{ form_errors(edit_form.dokumentazioak) }}
                        {{ form_widget(edit_form.dokumentazioak, {'attr': {'class': 'form-group select2'}}) }}
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if (eremuak.doklaguntext or eremuak.doklaguntable) %}
        <div class="row" id="dokumentuLaguntzaileak">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.doklagunlabeleu }}</h2>
                </div>
                {% if eremuak.doklaguntext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.doklaguneu) }}
                        {{ form_widget(edit_form.doklaguneu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.doklagunlabeles }}</h2>
                </div>
                {% if eremuak.doklaguntext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.doklagunes) }}
                        {{ form_widget(edit_form.doklagunes, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            {% if eremuak.doklaguntable %}
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                    <div class="form-group">
                        {{ form_errors(edit_form.doklagunak) }}
                        {{ form_widget(edit_form.doklagunak, {'attr': {'class': 'form-group select2'}}) }}
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if (eremuak.kanalatext or eremuak.kanalatable) %}
        <div class="row" id="kanala">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.kanalalabeleu }}</h2>
                </div>
                {% if eremuak.kanalatext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.kanalaeu) }}
                        {{ form_widget(edit_form.kanalaeu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.kanalalabeles }}</h2>
                </div>
                {% if eremuak.kanalatext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.kanalaes) }}
                        {{ form_widget(edit_form.kanalaes, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            {% if eremuak.kanalatable %}
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                    <div class="form-group">
                        {{ form_errors(edit_form.kanalak) }}
                        {{ form_widget(edit_form.kanalak, {'attr': {'class': 'form-control select2'}}) }}
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if (eremuak.kostuatext or eremuak.kostuatable) %}
        <div class="row" id="kostua">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.kostualabeleu }}</h2>
                </div>
                {% if eremuak.kostuatext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.kostuaeu) }}
                        {{ form_widget(edit_form.kostuaeu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.kostualabeles }}</h2>
                </div>
                {% if eremuak.kostuatext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.kostuaes) }}
                        {{ form_widget(edit_form.kostuaes, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
        </div>
            {% if eremuak.kostuatable %}
                <div class="row">
                    {% if fitxa.udala.zergaor %}
                        <ul class="list-unstyled" id="kostua-fields-list" data-prototype="{% filter escape %}{% include 'fitxakostua/prototype_new.html.twig' with {'form': edit_form.kostuak.vars.prototype,'udal':fitxa.udala,'fitxa':fitxa} %}{% endfilter %}">
                            <li class="burua"></li>
                            {% for kostua in edit_form.kostuak %}
                                <li>
                                    {% if app.environment == "dev" %}
                                        <div class="col-sm-2">{{ form_widget(kostua.udala) }}</div>
                                        <div class="col-sm-1">{{ form_widget(kostua.fitxa) }}</div>
                                    {% else %}
                                        <div class="col-sm-2" style="visibility: hidden;">{{ form_widget(kostua.udala) }}</div>
                                        <div class="col-sm-1" style="visibility: hidden;">{{ form_widget(kostua.fitxa) }}</div>
                                    {% endif %}
                                        <div class="col-sm-8">{{ form_widget(kostua.kostua) }}</div>

                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="form-group">
                            {{ form_errors(edit_form.azpiatalak) }}
                            {{ form_widget(edit_form.azpiatalak, {'attr': {'class': 'form-group select2'}}) }}
                        </div>
                    {% endif %}
                </div>
                {% if  udal.zergaor == true %}
                    <button type="button" id="add-kostua" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#modalSelectOrdenantza">
                        {{ 'messages.gehitukostu'|trans }}
                    </button>
                {% endif %}

            {% endif %}

    {% endif %}

    {% if (eremuak.ebazpensinpli or eremuak.arduraaitorpena or eremuak.aurreikusi or eremuak.arrunta or eremuak.isiltasunadmin) %}
        <div class="row" id="epeak">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.epealabeleu }}</h2>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.epealabeles }}</h2>
                </div>
            </div>
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                {% if eremuak.aurreikusi %}
                    <div class="form-group">
                        <label class="control-label">{{ labelak.aurreikusilabeleu }}
                            /{{ labelak.aurreikusilabeles }}</label>
                        {{ form_errors(edit_form.aurreikusi) }}
                        {{ form_widget(edit_form.aurreikusi, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
                {% if eremuak.arrunta %}
                    <div class="form-group">
                        <label class="control-label">{{ labelak.arruntalabeleu }}/{{ labelak.arruntalabeles }}</label>
                        {{ form_errors(edit_form.arrunta) }}
                        {{ form_widget(edit_form.arrunta, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}

                {% if eremuak.ebazpensinpli %}
                    <div class="form-group">
                        <label class="control-label">{{ labelak.ebazpensinplilabeleu }}</label>
                        {{ form_errors(edit_form.ebazpensinpli) }}
                        {{ form_widget(edit_form.ebazpensinpli, {'attr': {'class': 'c-checkbox'}}) }}
                        <label class="control-label">{{ labelak.ebazpensinplilabeles }}</label>
                    </div>
                {% endif %}

                {% if eremuak.arduraaitorpena %}
                    <div class="form-group">
                        <label class="control-label">{{ labelak.arduraaitorpenalabeleu }}</label>
                        {{ form_errors(edit_form.arduraaitorpena) }}
                        {{ form_widget(edit_form.arduraaitorpena, {'attr': {'class': 'c-checkbox'}}) }}
                        <label class="control-label">{{ labelak.arduraaitorpenalabeles }}</label>
                    </div>
                {% endif %}

                {% if eremuak.isiltasunadmin %}
                    <div class="form-group">
                        <label class="control-label">{{ labelak.isiltasunadminlabeleu }}
                            /{{ labelak.isiltasunadminlabeles }}</label>
                        {{ form_errors(edit_form.isiltasunadmin) }}
                        {{ form_widget(edit_form.isiltasunadmin, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}

    {% if (eremuak.araudiatext or eremuak.araudiatable) %}
        <div class="row" id="araudia">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.araudialabeleu }}</h2>
                </div>
                {% if eremuak.araudiatext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.araudiaeu) }}
                        {{ form_widget(edit_form.araudiaeu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.araudialabeles }}</h2>
                </div>
                {% if eremuak.araudiatext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.araudiaes) }}
                        {{ form_widget(edit_form.araudiaes, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            {% if eremuak.araudiatable %}

                <div class="row">
                    <div class="col-sm-1"></div>
                    <div class="col-sm-10">
                        <div class="form-group">
                            <ul class="list-unstyled" id="araudia-fields-list" data-prototype="{% filter escape %}
                {% include 'fitxaaraudia/prototype_new.html.twig' with {'form': edit_form.araudiak.vars.prototype,'fitxa':fitxa} %}{% endfilter %}">
                                <li class="burua">
                                    <div class="col-sm-7"><b>{{ 'messages.araudia'|trans }}</b></div>
                                    <div class="col-sm-2"><b>{{ 'messages.atala'|trans }} ({{ 'messages.eu'|trans }}
                                            )</b></div>
                                    <div class="col-sm-2"><b>{{ 'messages.atala'|trans }} ({{ 'messages.es'|trans }}
                                            )</b></div>
                                </li>
                                {% for araudia in edit_form.araudiak %}
                                    <li>
                                        <div class="col-sm-2 hidden">{{ form_widget(araudia.udala) }}</div>
                                        <div class="col-sm-4 hidden">{{ form_widget(araudia.fitxa) }}</div>
                                        <div class="col-sm-7">{{ form_widget(araudia.araudia, { 'attr': {'class': 'nireselect2'} }) }}</div>
                                        <div class="col-sm-2">{{ form_widget(araudia.atalaeu) }}</div>
                                        <div class="col-sm-2">{{ form_widget(araudia.atalaes) }}</div>
                                    </li>
                                {% endfor %}
                            </ul>
                            <a href="#" id="add-araudia"
                               class="col-sm-12 text-right">{{ 'messages.gehituaraudia'|trans }}</a>
                        </div>
                    </div>
                    <div class="col-dm-1"></div>
                </div>

            {% endif %}
        </div>
    {% endif %}

    {% if (eremuak.prozeduratext or eremuak.prozeduratable) %}
        <div class="row" id="prozedurak">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.prozeduralabeleu }}</h2>
                </div>
                {% if eremuak.prozeduratext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.prozeduraeu) }}
                        {{ form_widget(edit_form.prozeduraeu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.prozeduralabeles }}</h2>
                </div>
                {% if eremuak.prozeduratext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.prozeduraes) }}
                        {{ form_widget(edit_form.prozeduraes, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            {% if eremuak.prozeduratable %}
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                    <div class="form-group">
                        <ul class="list-unstyled" id="prozedura-fields-list" data-prototype="{% filter escape %}
                {% include 'fitxaprozedura/prototype_new.html.twig' with {'form': edit_form.prozedurak.vars.prototype,'udal':fitxa.udala,'fitxa':fitxa} %}{% endfilter %}">
                            <li class="burua">
                                <div class="col-sm-9"><b>{{ 'messages.prozedura'|trans }}</b></div>
                                <div class="col-sm-2"><b>{{ 'messages.ordena'|trans }}</b></div>
                            </li>
                            {% for prozedura in edit_form.prozedurak %}
                                <li>
                                    <div class="col-sm-2 hidden">{{ form_widget(prozedura.udala) }}</div>
                                    <div class="col-sm-4 hidden">{{ form_widget(prozedura.fitxa) }}</div>
                                    <div class="col-sm-9">{{ form_widget(prozedura.prozedura) }}</div>
                                    <div class="col-sm-2">{{ form_widget(prozedura.ordena) }}</div>
                                </li>
                            {% endfor %}
                        </ul>
                        <br/>
                        <a href="#" id="add-prozedura"
                           class="col-sm-12 text-right">{{ 'messages.gehituprozedura'|trans }}</a>
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if (eremuak.norkebatzitext or eremuak.norkebatzitable) %}
        <div class="row">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.norkebatzilabeleu }}</h2>
                </div>
                {% if eremuak.norkebatzitext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.norkonartueu) }}
                        {{ form_widget(edit_form.norkonartueu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.norkebatzilabeles }}</h2>
                </div>
                {% if eremuak.norkebatzitext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.norkonartues) }}
                        {{ form_widget(edit_form.norkonartues, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            {% if eremuak.norkebatzitable %}
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                    <div class="form-group">
                        {{ form_errors(edit_form.norkebatzi) }}
                        {{ form_widget(edit_form.norkebatzi, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if (eremuak.azpisailatable) %}
        <div class="row" id="azpisaila">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.azpisailalabeleu }}</h2>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.azpisailalabeles }}</h2>
                </div>
            </div>
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <div class="form-group">
                    {{ form_errors(edit_form.azpisaila) }}
                    {{ form_widget(edit_form.azpisaila, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
        </div>
    {% endif %}

    {% if eremuak.oharraktext %}
        <div class="row" id="oharrak">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.oharraklabeleu }}</h2>
                </div>
                <div class="form-group">
                    {{ form_errors(edit_form.oharrakeu) }}
                    {{ form_widget(edit_form.oharrakeu, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.oharraklabeles }}</h2>
                </div>
                <div class="form-group">
                    {{ form_errors(edit_form.oharrakes) }}
                    {{ form_widget(edit_form.oharrakes, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
        </div>
    {% endif %}

    <div class="row">
        <div class="col-sm-6">
            <div class="page-header">
                <h2>JARRAIBIDEAK (barne erabilera)</h2>
            </div>
            <div class="form-group">
                {{ form_errors(edit_form.jarraibideakeu) }}
                {{ form_widget(edit_form.jarraibideakeu, {'attr': {'class': 'form-control'}}) }}
            </div>
        </div>
        <div class="col-sm-6">
            <div class="page-header">
                <h2>INSTRUCCIONES (uso interno)</h2>
            </div>
            <div class="form-group">
                {{ form_errors(edit_form.jarraibideakes) }}
                {{ form_widget(edit_form.jarraibideakes, {'attr': {'class': 'form-control'}}) }}
            </div>
        </div>
    </div>

    {% if (eremuak.besteak1text or eremuak.besteak1table) %}
        <div class="row" id="besteak1">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.besteak1labeleu }}</h2>
                </div>
                {% if eremuak.besteak1text %}
                    <div class="form-group">
                        {{ form_errors(edit_form.besteak1eu) }}
                        {{ form_widget(edit_form.besteak1eu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.besteak1labeles }}</h2>
                </div>
                {% if eremuak.besteak1text %}
                    <div class="form-group">
                        {{ form_errors(edit_form.besteak1es) }}
                        {{ form_widget(edit_form.besteak1es, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            {% if eremuak.besteak1table %}
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                    <div class="form-group">
                        {{ form_errors(edit_form.besteak1ak) }}
                        {{ form_widget(edit_form.besteak1ak, {'attr': {'class': 'form-group select2'}}) }}
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if (eremuak.besteak2text or eremuak.besteak2table) %}
        <div class="row" id="besteak2">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.besteak2labeleu }}</h2>
                </div>
                {% if eremuak.besteak2text %}
                    <div class="form-group">
                        {{ form_errors(edit_form.besteak2eu) }}
                        {{ form_widget(edit_form.besteak2eu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.besteak2labeles }}</h2>
                </div>
                {% if eremuak.besteak2text %}
                    <div class="form-group">
                        {{ form_errors(edit_form.besteak2es) }}
                        {{ form_widget(edit_form.besteak2es, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            {% if eremuak.besteak2table %}
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                    <div class="form-group">
                        {{ form_errors(edit_form.besteak2ak) }}
                        {{ form_widget(edit_form.besteak2ak, {'attr': {'class': 'form-group select2'}}) }}
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if (eremuak.besteak3text or eremuak.besteak3table) %}
        <div class="row" id="besteak3">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.besteak3labeleu }}</h2>
                </div>
                {% if eremuak.besteak3text %}
                    <div class="form-group">
                        {{ form_errors(edit_form.besteak3eu) }}
                        {{ form_widget(edit_form.besteak3eu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.besteak3labeleu }}</h2>
                </div>
                {% if eremuak.besteak3text %}
                    <div class="form-group">
                        {{ form_errors(edit_form.besteak3es) }}
                        {{ form_widget(edit_form.besteak3es, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            {% if eremuak.besteak2table %}
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                    <div class="form-group">
                        {{ form_errors(edit_form.besteak3ak) }}
                        {{ form_widget(edit_form.besteak3ak, {'attr': {'class': 'form-group select2'}}) }}
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if (eremuak.datuenbabesatext or eremuak.datuenbabesatable) %}
        <div class="row">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.datuenbabesalabeleu }}</h2>
                </div>
                {% if eremuak.datuenbabesatext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.datuenbabesaeu) }}
                        {{ form_widget(edit_form.datuenbabesaeu, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>{{ labelak.datuenbabesalabeles }}</h2>
                </div>
                {% if eremuak.datuenbabesatext %}
                    <div class="form-group">
                        {{ form_errors(edit_form.datuenbabesaes) }}
                        {{ form_widget(edit_form.datuenbabesaes, {'attr': {'class': 'form-control'}}) }}
                    </div>
                {% endif %}
            </div>
            {% if eremuak.datuenbabesatable %}
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                    <div class="form-group">
                        {{ form_errors(edit_form.datuenbabesa) }}
                        {{ form_widget(edit_form.datuenbabesa, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>
                <div class="col-sm-2"></div>
            {% endif %}
        </div>
    {% endif %}

    {% if is_granted('ROLE_ADMIN') %}
        <div class="row" id="familia">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>FAMILIAK</h2>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>FAMILIAS</h2>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-6">
                <table class="table table-bordered">
                    <thead>
                    <th id="gehituFamilia">Familia</th>
                    <th>Ordena</th>
                    <th></th>
                    </thead>
                    <tbody>
                    {% for f in fitxa.fitxafamilia %}
                        <tr>
                            <td>{% if f.familia.parent %}{{ f.familia.parent ~ " => " }} {% endif %}{{ f.familia }}</td>
                            <td>{{ f.ordena }}</td>
                            <td>
                                <a class="btn-ordena" data-id="{{ f.id }}" href="javascript:void(0);"><i
                                            class="fa fa-pencil" aria-hidden="true"></i></a>
                                &nbsp;
                                <a class="btnOrdenaEzabatu" data-id="{{ f.id }}" href="javascript:void(0);"><i
                                            class="fa fa-trash text-danger"></i></a>

                            </td>
                        </tr>
                    {% endfor %}

                    </tbody>
                </table>
            </div>
            <div class="col-sm-2"></div>
        </div>
        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#modalFitxaFamilia">
            + Familia
        </button>

    {% endif %}

    {% if is_granted('ROLE_ADMIN') %}
        <div class="row" id="etiketak">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>ETIKETAK</h2>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>ETIQUETAS</h2>
                </div>
            </div>
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <div class="form-group">
                    {{ form_errors(edit_form.etiketak) }}
                    {{ form_widget(edit_form.etiketak, {'attr': {'class': 'form-control select2'}}) }}
                </div>
            </div>
        </div>
    {% endif %}

    {% if is_granted('ROLE_ADMIN') %}
    <div class="row" id="espedienteKudeaketa">
    {#{% else %}#}
    {#<div class="row hidden">#}
    {#{% endif %}#}
    <div class="col-sm-6">
        <div class="page-header">
            <h2>ESPEDIENTE KUDEAKETA</h2>
        </div>
    </div>
    <div class="col-sm-6">
        <div class="page-header">
            <h2>GESTIÓN DE EXPEDIENTES</h2>
        </div>
    </div>
    <div class="col-sm-7">
        <div class="form-group">
            <b>{{ 'messages.zerbitzua'|trans }}</b>
            {{ form_errors(edit_form.zerbitzua) }}
            {{ form_widget(edit_form.zerbitzua, {'attr': {'class': 'form-control'}}) }}
        </div>
    </div>
    <div class="col-sm-2">
        <div class="form-group">
            <b>{{ 'messages.parametroa'|trans }}</b>
            {{ form_errors(edit_form.parametroa) }}
            {{ form_widget(edit_form.parametroa, {'attr': {'class': 'form-control'}}) }}
        </div>
    </div>
    <div class="col-sm-2">
        <b>{{ 'messages.expedientes'|trans }}</b>
        {{ form_errors(edit_form.expedientes) }}
        {{ form_widget(edit_form.expedientes, {'attr': {'class': 'form-control'}}) }}

    </div>
    <div class="col-sm-1">
        <b>&nbsp;</b>
        <button type="button" class="btn" data-toggle="modal" data-target="#myModal">
            Seleccionar
        </button>

        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Espediente Kudeaketa</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="cmbServiciosDisponibles">Servicios Disponibles</label>
                                    <select id="cmbServiciosDisponibles" multiple class="form-control" size="9">
                                        <option value="00">00-Configuración</option>
                                        <option value="01">01-Registro</option>
                                        <option value="02">02-Multas</option>
                                        <option value="03">03-Detalle de Recibos SEPA</option>
                                        <option value="04">04-Tasas / Impuestos</option>
                                        <option value="05">05-P.M.H.</option>
                                        <option value="06">06-Consulta de Expedientes</option>
                                        <option value="07">07-Verificación de Documentos</option>
                                        <option value="08">08-Gestión de Expedientes</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="cmbParametros">Parametros</label>
                                    <select id="cmbParametros" multiple class="form-control" size="09">
                                    </select>
                                </div>

                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Ezeztatu</button>
                            <button type="button" class="btn btn-primary btnSeleccionar">Seleccionar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}


    {% if is_granted('ROLE_ADMIN') %}
        <div class="row hidden" id="admin">
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>ADMIN</h2>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="page-header">
                    <h2>ADMIN</h2>
                </div>
            </div>
        </div>
    {% endif %}

    {% if is_granted('ROLE_ADMIN') %}
        <div class="row">
            {% if is_granted('ROLE_SUPER_ADMIN') %}
                <div class="col-sm-2">
                    <div class="form-group">
                        <b>{{ 'messages.udala'|trans }}</b>
                        {#{{ form_label(edit_form.udala, 'Udala', { 'label_attr': {'class': 'control-label'} }) }}#}
                        {{ form_errors(edit_form.udala) }}
                        {{ form_widget(edit_form.udala, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>
            {% endif %}

            {% if is_granted('ROLE_ADMIN') %}
                <div class="col-sm-9 hidden">
                    <div class="form-group col-sm-4">
                        <b>{{ 'messages.kontsultak'|trans }}</b>
                        {#{{ form_label(edit_form.kontsultak, 'Kontsulta kopurua:', { 'label_attr': {'class': 'control-label'} }) }}#}
                        {{ form_errors(edit_form.kontsultak) }}
                        {{ form_widget(edit_form.kontsultak, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    <div class="form-group col-sm-4">
                        {{ form_errors(edit_form.publikoa) }}
                        {{ form_widget(edit_form.publikoa, {'attr': {'class': 'c-checkbox'}}) }}
                        {#{{ form_label(edit_form.publikoa, 'Publikoa da?', { 'label_attr': {'class': 'control-label'} }) }}#}
                        <b>{{ 'messages.publikoa'|trans }}</b>
                    </div>
                    <div class="form-group col-sm-4">
                        {{ form_errors(edit_form.hitzarmena) }}
                        {{ form_widget(edit_form.hitzarmena, {'attr': {'class': 'c-checkbox'}}) }}
                        {#{{ form_label(edit_form.hitzarmena, 'Hitzarmenean?', { 'label_attr': {'class': 'control-label'} }) }}#}
                        <b>{{ 'messages.hitzarmenean'|trans }}</b>
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if is_granted('ROLE_SUPER_ADMIN') %}
        <div class="row">
            <div class="form-group col-sm-4">
                <b>{{ 'messages.created'|trans }}</b>
                {#{{ form_label(edit_form.createdAt, 'Noiz sortua', { 'label_attr': {'class': 'control-label'} }) }}#}
                {{ form_errors(edit_form.createdAt) }}
                {{ form_widget(edit_form.createdAt, {'attr': {'class': 'form-control'}}) }}
            </div>
            <div class="form-group col-sm-4">
                <b>{{ 'messages.updated'|trans }}</b>
                {#{{ form_label(edit_form.updatedAt, 'Azken aldaketa', { 'label_attr': {'class': 'control-label'} }) }}#}
                {{ form_errors(edit_form.updatedAt) }}
                {{ form_widget(edit_form.updatedAt, {'attr': {'class': 'form-control'}}) }}
            </div>
        </div>
        </div>
        </div>
    {% endif %}

    <div class="hidden">
        {{ form_end(edit_form) }}
    </div>

    <div class="modal fade" id="modalFitxaFamilia" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Aukeratu Familia / Azpifamilia eta ordena</h4>
                </div>
                <div class="modal-body">
                    <div id="nireloader2" class=""></div>
                    {{ form_start(formfitxafamilia) }}
                    <div class="row">
                        <div class="col-sm-6">
                            <label for="cmbFamilia">Familia</label>
                            <select id="cmbFamilia" multiple class="form-control" size="9">
                                {% for fa in familiak %}
                                    <option value="{{ fa.id }}">{{ fa.familiaeu }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-sm-6">
                            <label for="cmbAzpifamilia">Azpifamilia</label>
                            <select id="cmbAzpifamilia" multiple class="form-control" size="09">
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4"></div>
                        <div class="col-sm-4">
                            {{ form_label(formfitxafamilia.ordena, 'Ordena', { 'label_attr': {'class': 'control-label'} }) }}
                            {{ form_widget(formfitxafamilia.ordena , {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-sm-4">
                            <p id="badago" class="bg-danger" style="display: none;"><br> Zehaztua dagoeneko.</p>
                        </div>
                    </div>

                    <div class="row">&nbsp;</div>
                    <div class="row">
                        <div style="display: none;">
                            <div class="row">{{ form_end(formfitxafamilia) }}</div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Ezeztatu</button>
                    <button id="saveButton" type="button"
                            onclick="document.forms['{{ formfitxafamilia.vars.name }}'].submit()"
                            class="btn btn-primary">Gorde
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="modalOrdena" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        {#<div class=" id="modalOrdena" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">#}
        <div class="modal-dialog">
            <form id="frmfitxafamilia" name="frmfitxafamilia" method="post" action="" role="form">
                <div id="modalOrdenabody" class="modal-content">

                </div><!-- /.modal-content -->
            </form>
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="modalSelectOrdenantza" role="dialog" aria-labelledby="gridSystemModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Aukeratu kotzeptua</h4>
                </div>
                <div class="modal-body">
                    <div id="nireloader3" class=""></div>
                    <div class="row">
                        <p></p>
                    </div>
                    <div class="row">
                        <div class="col-md-12 form-group" >
                            <p>
                                <label for="cmbOrdenantza">Ordenantza</label>
                                <select name="cmbOrdenantza" id="cmbOrdenantza" style="width:100%"></select>
                            </p>
                        </div>
                    </div>
                    <div class="row">
                        <p></p>
                    </div>
                    <div class="row">
                        <div class="col-md-12 form-group" >
                            <p>
                                <label for="cmbAtala">Atala</label>
                                <select name="cmbAtala" id="cmbAtala" style="width:100%"></select>
                            </p>
                        </div>

                    </div>
                    <div class="row">
                        <p></p>
                    </div>
                    <div class="row">
                        <div class="col-md-12 form-group" >
                            <p>
                                <label for="cmbKontzeptua">Kontzeptua</label>
                                <select name="cmbKontzeptua" id="cmbKontzeptua" style="width:100%"></select>
                            </p>
                        </div>

                    </div>

                    <div style="display: none;">
                        <input type="hidden" name="dest" id="dest" value="">
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{ "Ezeztatu" | trans }}</button>
                    <button id="saveButton" type="button" class="btn btn-primary disabled ">{{ "Gorde" | trans }}</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


    <input id="fitxa_id" type="hidden" value="{{ fitxa.id }}">
    <input id="udala_id" type="hidden" value="{{ udala}}">
    <input id="udala_kodea" type="hidden" value="{{ udal.kodea }}">
    <input id="url_api_zzoo" type="hidden" value="{{ zzoo_aplikazioaren_API_url }}">

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">


        $(function () {

            $( "#btnFitxaGrabatu" ).on( "click", function () {

                var akatsa = 0;
                var expedientes = $( "#fitxa_expedientes" ).val();
                var parametroa = $( "#fitxa_parametroa" ).val();

                if ( parametroa.length > 0 ) {
                    if ( parametroa.substring(0,2) === "08" ) {
                        if ( expedientes.length > 0 ) {
                            $( "#frm_fitxa_edit" ).submit();
                            return;
                        } else {
                            alert( "Fitxaren Espediente kodea zehaztea beharrezkoa da." );
                            return
                        }
                    }
                }


                $(".kostutaula").each(function() {
                    if ( $(this).val() === "-1" ) {
                        alert( "Kostu taula huts bat gehitu duzu. Aukeratu kostu taula ala ezabatu gehitutako kostu taula." );
                        akatsa = 1;
                    }
                });

                $(".araudiasel").each(function() {
                    if ( $(this).val().length === 0 ) {
                        alert( "Araudi huts bat gehitu duzu. Aukeratu araudi bat ala ezabatu." );
                        akatsa = 1;
                    }
                });

                $(".prozedurasel").each(function() {
                    if ( $(this).val().length === 0 ) {
                        alert( "Prozedura huts bat gehitu duzu. Aukeratu prozedura bat ala ezabatu." );
                        akatsa = 1;
                    }
                });

                if (akatsa === 0 ) {
                    $( "#frm_fitxa_edit" ).submit();
                }

            } );

            $( "#fitxa_expedientes" ).on( "focus", function () {
                var parametroa = $( "#fitxa_parametroa" ).val();
                if ( parametroa.substring(0,2) === "08" ) {
                    if ( $(this).val().length === 0 ) {
                        $( this ).val( $( "#fitxa_espedientekodea" ).val() );
                    }
                }
            });

            $(".kostutaula").each(function() {
                console.log($( this ).val());
            });

            /**
             * Goazen konboak kargatzera
             */
            var param = "{{ zzoo_aplikazioaren_API_url }}";
            var udalaid = $('#udala_id').val();
            var udalakodea = $('#udala_kodea').val();

            var url = param + "/ordenantzakbykodea/"+udalakodea+".json";
            var locale ="{{ app.request.getLocale() }}";

            var jqxhr = $.getJSON(url, function (result) {
                if (locale === "es") {
                    $("#cmbOrdenantza").append($("<option></option>").attr("value", -1).text("Selecciona"));
                } else{
                    $("#cmbOrdenantza").append($("<option></option>").attr("value", -1).text("Aukeratu"));
                }
                $.each(result, function (i, field) {
                    if (locale === "es") {
                        $("#cmbOrdenantza").append($("<option></option>").attr("value", field.id).text(field.izenburuaes_prod));
                    } else {
                        $("#cmbOrdenantza").append($("<option></option>").attr("value", field.id).text(field.izenburuaeu_prod));
                    }
                });
            });

            jqxhr.complete(function () {
                $("#cmbOrdenantza").select2({
                    theme: 'bootstrap',
                });
            });


            $('#cmbOrdenantza').on('change', function () {
                console.log("ordenantza change")
                $('#nireloader3').addClass('loading');
                var ordenantzaid = $(this).val();
                var url = param + "/tributuak/" + ordenantzaid + ".json";

                var jqxhr = $.getJSON(url, function (result) {
                    $("#cmbAtala").empty();
                    $("#cmbKontzeptua").empty();
                    if (locale === "es") {
                        $("#cmbAtala").append($("<option></option>").attr("value", -1).text("Selecciona"));
                    } else{
                        $("#cmbAtala").append($("<option></option>").attr("value", -1).text("Aukeratu"));
                    }

                    if (result.length === 0) {
                        return;
                    }
                    var atalak = result;

                    $.each(atalak, function (i, field) {
                        if ( ('izenburuaes_prod' in field) || ('izenburuaes_prod' in field) )
                        if (locale === "es") {
                            var txt ="";
                            if ( field.izenburuaes_prod.replace('<br>','').replace('</br>','').length > 200 ) {
                                txt = field.izenburuaes_prod.replace('<br>','').replace('</br>','').substr(0, 200);
                            } else {
                                txt = field.izenburuaes_prod;
                            }
                            $("#cmbAtala").append($("<option></option>").attr("value", field.id).text(txt));
                        } else {
                            var txt ="";
                            if ( field.izenburuaes_prod.replace('<br>','').replace('</br>','').length > 200 ) {
                                txt = field.izenburuaeu_prod.replace('<br>','').replace('</br>','').substr(0, 200);
                            } else {
                                txt = field.izenburuaeu_prod;
                            }
                            $("#cmbAtala").append($("<option></option>").attr("value", field.id).text(txt));
                        }

                        // bete zergen cmb

                        if (locale === "es") {
                            $("#cmbKontzeptua").append($("<option></option>").attr("value", -1).text("Selecciona"));
                        } else{
                            $("#cmbKontzeptua").append($("<option></option>").attr("value", -1).text("Aukeratu"));
                        }
                        var azpiatalak = field.azpiatalak;
                        $.each(azpiatalak, function (i, azpi) {


                            if (locale === "es") {
                                var txt = "";
                                if (azpi.izenburuaes_prod.replace('<br>','').replace('</br>','').length > 200) {
                                    txt = azpi.izenburuaes_prod.replace('<br>','').replace('</br>','').substr(0, 200);
                                } else {
                                    txt = azpi.izenburuaes_prod;
                                }
                                $("#cmbKontzeptua").append($("<option></option>").attr("value", azpi.id).text(txt));
                            } else {
                                var txt = "";
                                if (azpi.izenburuaeu_prod.replace('<br>','').replace('</br>','').length > 200) {
                                    txt = azpi.izenburuaeu_prod.replace('<br>','').replace('</br>','').substr(0, 200);
                                } else {
                                    txt = azpi.izenburuaeu_prod;
                                }
                                $("#cmbKontzeptua").append($("<option></option>").attr("value", azpi.id).text(txt));
                            }


                        });
                    });
                });

                jqxhr.complete(function () {
                    $("#cmbAtala").select2({
                        theme: 'bootstrap',
                    });
                    $("#cmbKontzeptua").select2({
                        theme: 'bootstrap',
                    });
                    $('#nireloader3').removeClass('loading');
                });

            });

            $('#cmbAtala').on('change', function () {
                console.log("atala change")
                $('#nireloader3').addClass('loading');
                var atalaid = $(this).val();
                var url = param + "/zergak/" + atalaid + ".json";

                var jqxhr = $.getJSON(url, function (result2) {
                    $("#cmbKontzeptua").empty();
                    if (locale === "es") {
                        $("#cmbKontzeptua").append($("<option></option>").attr("value", -1).text("Selecciona"));
                    } else{
                        $("#cmbKontzeptua").append($("<option></option>").attr("value", -1).text("Aukeratu"));
                    }

                    if (result2.length === 0) {
                        return;
                    }

                    var azpiatalak = result2;

                    $.each(azpiatalak, function (i, field2) {

                        if (locale === "es") {
                            var txt ="";
                            if ( field2.izenburuaes_prod.replace('<br>','').replace('</br>','').length > 200 ) {
                                txt = field2.izenburuaes_prod.replace('<br>','').replace('</br>','').substr(0, 200);
                            } else {
                                txt = field2.izenburuaes_prod;
                            }
                            $("#cmbKontzeptua").append($("<option></option>").attr("value", field2.id).text(txt));
                        } else {
                            var txt ="";
                            if ( field2.izenburuaeu_prod.replace('<br>','').replace('</br>','').length > 200 ) {
                                txt = field2.izenburuaeu_prod.replace('<br>','').replace('</br>','').substr(0, 200);
                            } else {
                                txt = field2.izenburuaeu_prod;
                            }
                            $("#cmbKontzeptua").append($("<option></option>").attr("value", field2.id).text(txt));
                        }
                    });
                });

                jqxhr.complete(function () {
                    $("#cmbKontzeptua").select2({
                        theme: 'bootstrap',
                    });
                    $('#nireloader3').removeClass('loading');
                });

            });

            $('#cmbKontzeptua').on('change', function () {
                console.log("kontzeptua change")
                var kontzeptuaid = $("#cmbKontzeptua").val();

                if ( kontzeptuaid === -1 ) {
                    return;
                } else {
                    var midest = $('#dest').val();
                    $('#' + midest).val(kontzeptuaid).trigger('change');
                    console.log("vbalioa da : " + kontzeptuaid);
                    $('#modalSelectOrdenantza').modal('toggle')
                }
            });

            $('#saveButton').on('click', function () {
                var kontzeptuaid = $(this).val();

                if ( kontzeptuaid === -1 ) {
                    return;
                } else {
                    $('#saveButton').removeClass("disabled");
                }
            });


            var shiftWindow = function () {
                scrollBy(0, -75)
            };
            if (location.hash) shiftWindow();
            window.addEventListener("hashchange", shiftWindow);


            var customSorter = function (data) {

                return data.sort(function (a, b) {
                    a = a.text.toLowerCase();
                    b = b.text.toLowerCase();
                    if (a > b) {
                        return 1;
                    } else if (a < b) {
                        return -1;
                    }
                    return 0;
                });

            };

            $('#fitxafamilia_familia').select2();
            $('#fitxa_etiketak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_familiak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_kanalak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_doklagunak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_besteak1ak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_besteak2ak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_besteak3ak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_azpiatalak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_araudiak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_prozedurak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_norkeskatuak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('#fitxa_dokumentazioak').select2({
                theme: 'bootstrap',
                tags: true,
                sorter: customSorter
            });
            $('.nireselect2').select2({
                theme: 'bootstrap',
                sorter: customSorter
            });


            $('#cmbServiciosDisponibles').change(function () {

                var aukera = $(this).val();

                if (aukera == "01") {
                    $('#cmbParametros').empty();
                    $('#cmbParametros').append($("<option selected></option>").attr("value", "01").text("01-Creación de un registro de entrada"));
                } else if (aukera == "05") {
                    $('#cmbParametros').empty();
                    $('#cmbParametros').append($("<option selected></option>").attr("value", "01").text("01-Listado de personas de la vivienda"));
                    $('#cmbParametros').append($("<option></option>").attr("value", "02").text("02-Historial de empadronamiento"));
                    $('#cmbParametros').append($("<option></option>").attr("value", "03").text("03-Certificado de empadronamiento"));
                } else if (aukera == "08") {
                    $('#cmbParametros').empty();
                    $('#cmbParametros').append($("<option selected></option>").attr("value", "00").text("00-Página de ayuda de este tipo de expediente"));
                    $('#cmbParametros').append($("<option></option>").attr("value", "01").text("01-Manual de procedicimiento"));
                    $('#cmbParametros').append($("<option></option>").attr("value", "02").text("02-Instancia"));
                    $('#cmbParametros').append($("<option></option>").attr("value", "03").text("03-Inicio de expediente"));
                } else {
                    $('#cmbParametros').empty();
                }
            });

            $('#cmbFamilia').change(function () {
                $('#nireloader2').addClass('loading');
                $('#badago').hide();
                var aukera = $(this).val();
                var fitxaid = $('#fitxa_id').val();
                var urlOrdena = Routing.generate('api_fitxafamilianextorden', {
                    _locale: 'eu',
                    fitxa_id: fitxaid,
                    familia_id: aukera
                });


                $('#cmbAzpifamilia').empty();

                var jqxhr2 = $.getJSON(urlOrdena, function (result) {
                    if (result.ordena === null) {
                        $('#saveButton').show();
                        var miorden = 1;
                    } else if (result.ordena === -1) {
                        $('#saveButton').hide();
                        $('#badago').toggle();
                    } else {
                        $('#saveButton').show();
                        var miorden = parseInt(result.ordena) + 1;
                    }

                    $('#fitxafamilia_ordena').val(miorden);
                });


                $("#fitxafamilia_familia").val(aukera).trigger("change");
                var url = Routing.generate('get_azpifamiliak', {id: aukera});

                var jqxhr = $.getJSON(url, function (result) {
                    $.each(result, function (i, field) {
                        $("#cmbAzpifamilia").append($("<option></option>").attr("value", field.id).text(field.familiaeu));
                    });
                });

                jqxhr.complete(function () {
                    console.log("finito");
                    $('#nireloader2').removeClass('loading');
                });

            });

            $('#cmbAzpifamilia').change(function () {
                $('#nireloader2').addClass('loading');
                $('#badago').hide();

                var aukera = $(this).val();
                var fitxaid = $('#fitxa_id').val();
                var urlOrdena = Routing.generate('api_fitxafamilianextorden', {
                    _locale: 'eu',
                    fitxa_id: fitxaid,
                    familia_id: aukera
                });
                var jqxhr2 = $.getJSON(urlOrdena, function (result) {
                    if (result.ordena === null) {
                        $('#saveButton').show();
                        var miorden = 1;
                    } else if (result.ordena === -1) {
                        $('#saveButton').hide();
                        $('#badago').toggle();
                    } else {
                        $('#saveButton').show();
                        var miorden = parseInt(result.ordena) + 1;
                    }

                    $('#fitxafamilia_ordena').val(miorden);
                });

                $("#fitxafamilia_familia").val(aukera).trigger("change");

                jqxhr2.complete(function () {
                    $('#nireloader2').removeClass('loading');
                })

            });

            $('.btnSeleccionar').click(function () {
                var resul = "";
                var nireParametroak = $('#cmbParametros option').size();
                resul = $('#cmbServiciosDisponibles').val();
                if (nireParametroak > 0) {
                    var param = $('#cmbParametros').val();
                    resul = resul + param;
                }

                $('#fitxa_parametroa').val(resul);
                $('#myModal').modal('toggle');
            });

            $('.btn-ordena').click(function () {

                $('#nireloader').addClass('loading');
                var miid = $(this).data('id');

                var url = Routing.generate('fitxafamilia_edit', {_locale: 'eu', id: miid});

                $('#modalOrdenabody').load(url, function () {
                    $("#frmfitxafamilia").attr("action", url);
                    $('#modalOrdena').modal();
                });

                $('#modalOrdena').on('shown.bs.modal', function (e) {
                    $('#nireloader').removeClass('loading');
                });
            });

            $('.btnOrdenaEzabatu').on('click', function () {
                var that = $(this);
                bootbox.confirm({
                    title: "Ziur zaude familia ezabatu nahi duzula fitxatik?",
                    message: "Fitxatik ezabatuko da familiaren informazioa baina ez Familia bera.",
                    buttons: {
                        cancel: {
                            label: '<i class="fa fa-times"></i> Ezeztatu'
                        },
                        confirm: {
                            label: '<i class="fa fa-check"></i> Onartu'
                        }
                    },
                    callback: function (result) {
                        if (result === true) {
                            var miid = $(that).data('id');
                            console.log("miid =>" + miid);
                            var url = Routing.generate('fitxafamilia_delete', {_locale: 'eu', id: miid});
                            console.log("familia delete url => " + url);

                            $.ajax({
                                url: url,
                                type: 'delete',
                                success: function (result) {
                                    console.log('Delete');
                                    $(that).closest("tr").remove();
                                },
                                error: function (e) {
                                    console.log(e.responseText);
                                }
                            });

                        }
                    }
                });
            });

        });
    </script>

    <script type="text/javascript">
        // Zenbat prozedura gehitu diren gorde
        var prozeduraCount = '{{ edit_form.prozedurak|length }}';
        var araudiaCount = '{{ edit_form.araudiak|length }}';
        var kostuaCount = '{{ edit_form.kostuak|length }}';

        jQuery(document).ready(function () {

            // Get the ul that holds the collection of tags
            $collectionHolder = $('#kostua-fields-list');
            // add a delete link to all of the existing tag form li elements
            $collectionHolder.find('li').each(function () {
                if (!$(this).hasClass("burua"))
                    addKostuaFormDeleteLink($(this));
            });

            // Araudiak dituen ul-a jaso
            $collectionHolder = $('#araudia-fields-list');
            // li elementu guztiei ezabatzeko ikonoa jarri
            $collectionHolder.find('li').each(function () {
                if (!$(this).hasClass("burua"))
                    addAraudiaFormDeleteLink($(this));
            });
            // Prozedurak dituen ul-a jaso
            $collectionHolder = $('#prozedura-fields-list');
            // li elementu guztiei ezabatzeko ikonoa jarri
            $collectionHolder.find('li').each(function () {
                if (!$(this).hasClass("burua"))
                    addProzeduraFormDeleteLink($(this));
            });


            jQuery('#add-prozedura').click(function (e) {
                e.preventDefault();
//                alert ("sartu da!!");
                var prozeduraList = jQuery('#prozedura-fields-list');

                // grab the prototype template
                var newWidget = prozeduraList.attr('data-prototype');
                // replace the "__name__" used in the id and name of the prototype
                // with a number that's unique to your emails
                // end name attribute looks like name="contact[emails][2]"
                newWidget = newWidget.replace(/__name__/g, prozeduraCount);
                prozeduraCount++;

                // create a new list element and add it to the list
                var newLi = jQuery('<li></li>').html(newWidget);
                newLi.appendTo(prozeduraList);
            });
            jQuery('#add-araudia').click(function (e) {
                e.preventDefault();
//                alert ("sartu da!!");
                var araudiaList = jQuery('#araudia-fields-list');

                // grab the prototype template
                var newWidget = araudiaList.attr('data-prototype');
                // replace the "__name__" used in the id and name of the prototype
                // with a number that's unique to your emails
                // end name attribute looks like name="contact[emails][2]"
                newWidget = newWidget.replace(/__name__/g, araudiaCount);

                var selectIzena = "#fitxa_araudiak_" + araudiaCount + "_araudia";

                araudiaCount++;

                // create a new list element and add it to the list
                var newLi = jQuery('<li></li>').html(newWidget);
                newLi.appendTo(araudiaList);

                // Ordenatzen
                var customSorter = function (data) {

                    return data.sort(function (a, b) {
                        a = a.text.toLowerCase();
                        b = b.text.toLowerCase();
                        if (a > b) {
                            return 1;
                        } else if (a < b) {
                            return -1;
                        }
                        return 0;
                    });

                };


                $(selectIzena).select2({
                    theme: 'bootstrap',
                    width: 'resolve',
                    sorter: customSorter

                });

            });
            jQuery('#add-kostua').click(function (e) {
                e.preventDefault();
                var locale ="{{ app.request.getLocale() }}";
                $('#cmbOrdenantza').val(-1).trigger("change");
                $('#cmbAtala').empty();
                $("#cmbKontzeptua").empty();
                if (locale === "es") {
                    $("#cmbKontzeptua").append($("<option></option>").attr("value", -1).text("Selecciona"));
                } else{
                    $("#cmbKontzeptua").append($("<option></option>").attr("value", -1).text("Aukeratu"));
                }


                var kostuaList = jQuery('#kostua-fields-list');
                var newWidget = kostuaList.attr('data-prototype');
                newWidget = newWidget.replace(/__name__/g, kostuaCount);
                $('#dest').val("fitxa_kostuak_" + kostuaCount + "_kostua");
                var ni = ".nirerow" + kostuaCount;
                var niez= parseInt(kostuaCount);
                kostuaCount++;
                var newLi = jQuery('<li></li>').html(newWidget);

                var $removeFormA = '<div class="col-sm-1"><a href="javascript:void(0);" onclick="funcEzabatu(\'.nirerow'+ niez +'\')" class="cmdEzabatuRow"><i class="fa fa-times text-danger cmdEzabatuRow"></i></a></div>';
                $(newLi).appendTo($removeFormA);

                newLi.appendTo(kostuaList);

                $(ni).append($removeFormA);
            });



        });


        function funcEzabatu(nirediv) {
            console.log(nirediv);
            $(nirediv).remove();
        }

        function addKostuaFormDeleteLink($tagFormLi) {
            var $removeFormA = $('<div class="col-sm-1"><a href="#"><i class="fa fa-times text-danger"></i></a></div>');
            $tagFormLi.append($removeFormA);

            $removeFormA.on('click', function (e) {
                // prevent the link from creating a "#" on the URL
                e.preventDefault();

                // remove the li for the tag form
                $tagFormLi.remove();
            });
        }
        function addAraudiaFormDeleteLink($tagFormLi) {
            var $removeFormA = $('<div class="col-sm-1"><a href="#"><i class="fa fa-times text-danger"></i></a></div>');
            $tagFormLi.append($removeFormA);

            $removeFormA.on('click', function (e) {
                // prevent the link from creating a "#" on the URL
                e.preventDefault();

                // remove the li for the tag form
                $tagFormLi.remove();
            });
        }
        function addProzeduraFormDeleteLink($tagFormLi) {
            var $removeFormA = $('<div class="col-sm-1"><a href="#"><i class="fa fa-times text-danger"></i></a></div>');
            $tagFormLi.append($removeFormA);

            $removeFormA.on('click', function (e) {
                // prevent the link from creating a "#" on the URL
                e.preventDefault();

                // remove the li for the tag form
                $tagFormLi.remove();
            });
        }
    </script>

{% endblock %}